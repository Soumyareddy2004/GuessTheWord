{% extends "game/base.html" %}
{% block content %}
<style>
  body {
    background: #111827; 
    color: #f9fafb;
  }

  .game-page {
    max-width: 820px;
    margin: 20px auto;
    padding: 20px;
    background: #1f2937; 
    border-radius: 12px;
    box-shadow: 0 8px 28px rgba(0,0,0,0.45);
    border: 1px solid #374151;
    font-family: system-ui, sans-serif;
  }

  .game-top {
    display:flex;
    justify-content:space-between;
    align-items:center;
    margin-bottom: 16px;
  }

  .game-stats { font-weight:700; color:#e5e7eb; }
  .hint { color:#9ca3af; font-size:14px; }

  .guess-row { margin-bottom:12px; }
  .tile {
    display:inline-block;
    width:54px; height:54px; line-height:54px;
    text-align:center;
    margin:4px;
    font-weight:800;
    border-radius:8px;
    border:2px solid #4b5563;
    font-size:20px;
    background:#1f2937;
    color:#f3f4f6;
  }
  .green { background:#22c55e; color:#fff; border-color:#16a34a; }
  .orange { background:#eab308; color:#fff; border-color:#ca8a04; }
  .grey { background:#4b5563; color:#d1d5db; border-color:#374151; }

  .guess-form {
    display:flex;
    gap:12px;
    align-items:center;
    margin-top:16px;
    flex-wrap:wrap;
  }
  .guess-input {
    padding:10px 12px;
    font-size:18px;
    width:220px;
    border-radius:8px;
    border:1px solid #374151;
    background:#111827;
    color:#f9fafb;
  }
  .guess-input:focus {
    border-color:#60a5fa;
    box-shadow: 0 0 0 2px rgba(59,130,246,0.4);
    outline: none;
  }

  .submit-btn {
    padding:10px 16px;
    border-radius:8px;
    background:linear-gradient(180deg,#2563eb,#1d4ed8);
    color:white;
    font-weight:700;
    border:none;
    cursor:pointer;
  }
  .submit-btn:hover { background:#1d4ed8; }

  .modal {
    display:block;
    position:fixed;
    z-index:1100;
    left:0;top:0;
    width:100%;height:100%;
    background:rgba(0,0,0,0.7);
  }
  .modal-inner {
    max-width:420px;
    margin:14% auto;
    background:#1f2937;
    border-radius:12px;
    padding:24px;
    text-align:center;
    box-shadow:0 10px 30px rgba(0,0,0,0.6);
    border:1px solid #374151;
  }
  .modal-inner p { font-size:18px; color:#f9fafb; }
  .modal-word { font-weight:700; color:#facc15; margin-top:10px; }

  .modal-ok {
    background:#22c55e;
    color:#fff;
    padding:10px 18px;
    border-radius:8px;
    border:none;
    font-weight:700;
    cursor:pointer;
    margin-top:16px;
  }
  .modal-ok:hover { background:#16a34a; }

  @media (max-width:620px){
    .tile { width:44px; height:44px; line-height:44px; font-size:18px; }
    .guess-input { width:160px; font-size:16px; }
    .modal-inner { margin-top:22%; width:90%; padding:18px; }
  }
</style>

<div class="game-page">
  <div class="game-top">
    <div>
      <div class="game-stats">Guesses used: {{ game.guesses_used }} / {{ game.guesses_allowed }}</div>
      <div class="hint">Enter 5-letter words in UPPERCASE. Max 5 guesses per game.</div>
    </div>
  </div>

  <div>
    {% if guesses_display %}
      {% for guess in guesses_display %}
        <div class="guess-row">
          {% for pair in guess %}
            {% with ch=pair.0 st=pair.1 %}
              <span class="tile {{ st }}">{{ ch }}</span>
            {% endwith %}
          {% endfor %}
        </div>
      {% endfor %}
    {% else %}
      <p class="hint">No guesses yet. Good luck!</p>
    {% endif %}
  </div>

  {% if not game.finished %}
    <form method="post" class="guess-form">{% csrf_token %}
      <input name="guess" class="guess-input" maxlength="5" required pattern="[A-Z]{5}" 
             title="5 uppercase letters" placeholder="ABCDE" />
      <button type="submit" class="submit-btn">Submit Guess</button>
    </form>
  {% else %}
    <!-- Modal -->
    <div class="modal">
      <div class="modal-inner">
        <p>
          {% if game.win %}
            ðŸŽ‰ <strong>Congratulations!</strong> You guessed the word!
          {% else %}
            <strong>Better luck next time!</strong>
          {% endif %}
        </p>
        {% if not game.win %}
          <div class="modal-word">The word was: {{ game.word.text|default:"the word" }}</div>
        {% endif %}
        <button id="modalOkBtn" class="modal-ok">OK</button>
      </div>
    </div>

    <script>
       if (window.history && window.history.replaceState) {
    window.history.replaceState(null, document.title, window.location.pathname + window.location.search);
  }
      document.getElementById("modalOkBtn").onclick = function() {
        window.location.href = "{% url 'game:dashboard' %}";
      }
    </script>
  {% endif %}
</div>
{% endblock %}
